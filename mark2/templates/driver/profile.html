{% extends "base.html" %} {% block extra_css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/dashboard.css') }}"
/>
{% endblock %} {% block content %}
<div class="dashboard-container">
  <div class="card profile-card">
    <h2>Driver Profile</h2>
    <form id="profileForm">
      <div class="form-group">
        <label>Name</label>
        <input
          type="text"
          name="name"
          value="{{ profile.name if profile else '' }}"
        />
      </div>
      <div class="form-group">
        <label>Phone</label>
        <input
          type="tel"
          name="phone"
          value="{{ profile.phone if profile else '' }}"
        />
      </div>
      <button type="submit" class="btn">Update Profile</button>
    </form>
  </div>

  <div class="card location-card">
    <h2>Live Location Tracking</h2>
    <div id="map" style="height: 400px"></div>
    <div class="toggle-container">
      <label class="switch">
        <input type="checkbox" id="locationToggle" />
        <span class="slider"></span>
      </label>
      <span>Share Location</span>
    </div>
  </div>

  <div class="card notifications-card">
    <h2>Absent Students</h2>
    <div class="notifications-list">
      {% for student in absent_students %}
      <div class="notification">
        <p>{{ student.name }} will be absent today</p>
        <span class="timestamp"
          >{{ student.updated_at.strftime('%H:%M') }}</span
        >
      </div>
      {% endfor %}
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY"></script>
<script src="{{ url_for('static', filename='js/location.js') }}"></script>
<script>
  const locationTracker = new LocationTracker();
  const toggle = document.getElementById("locationToggle");

  toggle.addEventListener("change", (e) => {
    if (e.target.checked) {
      locationTracker.startTracking();
    } else {
      locationTracker.stopTracking();
    }
  });

  function initMap() {
    const map = new google.maps.Map(document.getElementById("map"), {
      center: { lat: 0, lng: 0 }, // Default center
      zoom: 15,
    });

    // Update the map with the driver's current location
    navigator.geolocation.getCurrentPosition((position) => {
      const driverLocation = {
        lat: position.coords.latitude,
        lng: position.coords.longitude,
      };
      map.setCenter(driverLocation);
      new google.maps.Marker({
        position: driverLocation,
        map: map,
        title: "Your Location",
      });
    });
  }

  initMap();
</script>
{% endblock %}

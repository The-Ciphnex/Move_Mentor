{% extends "base.html" %} {% block extra_css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/driver_dashboard.css') }}"
/>
{% endblock %} {% block content %}
<div class="dashboard-container">
  <div class="card location-card">
    <h2>Live Bus Location</h2>
    <div id="map" style="height: 400px"></div>
  </div>

  <div class="card notifications-card">
    <h2>Notifications</h2>
    <div class="notifications-list">
      {% for notification in notifications %}
      <div class="notification">
        <p>{{ notification.message }}</p>
        <span class="timestamp"
          >{{ notification.timestamp.strftime('%H:%M') }}</span
        >
      </div>
      {% endfor %}
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC77nilbjFldytx5doMTQ-Qf3EGp8Yg87c"></script>
<script>
  function initMap() {
    const map = new google.maps.Map(document.getElementById("map"), {
      center: { lat: 0, lng: 0 }, // Default center
      zoom: 15,
    });

    // Fetch the bus route and location
    fetch(`/api/bus-location/${session["route_number"]}`)
      .then((response) => response.json())
      .then((data) => {
        const busLocation = data.location; // Current bus location
        const busRoute = data.route; // Bus route coordinates

        // Set the map center to the bus location
        const busLatLng = { lat: busLocation.lat, lng: busLocation.lng };
        map.setCenter(busLatLng);
        new google.maps.Marker({
          position: busLatLng,
          map: map,
          title: "Bus Location",
        });

        // Draw the route on the map
        const routePath = new google.maps.Polyline({
          path: busRoute,
          geodesic: true,
          strokeColor: "#FF0000",
          strokeOpacity: 1.0,
          strokeWeight: 2,
        });
        routePath.setMap(map);
      });
  }

  initMap();
</script>
{% endblock %}
